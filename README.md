# Outlivion VPN Mini App

Telegram Mini App –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è VPN –ø–æ–¥–ø–∏—Å–∫–æ–π Outlivion.

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- Node.js 18+ 
- npm –∏–ª–∏ yarn
- Telegram Bot Token (–ø–æ–ª—É—á–∏—Ç—å —É [@BotFather](https://t.me/BotFather))

### –£—Å—Ç–∞–Ω–æ–≤–∫–∞

1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:
```bash
npm install
```

2. –°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `.env.local` –Ω–∞ –æ—Å–Ω–æ–≤–µ `.env.example`:
```bash
cp .env.example .env.local
```

3. –ó–∞–ø–æ–ª–Ω–∏—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –≤ `.env.local`:
```env
# –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ: —Ç–æ–∫–µ–Ω –±–æ—Ç–∞ –æ—Ç BotFather
TELEGRAM_BOT_TOKEN=your_bot_token_here

# –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ: –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
NEXT_PUBLIC_API_BASE_URL=http://localhost:3000
```

4. –ó–∞–ø—É—Å—Ç–∏—Ç–µ dev —Å–µ—Ä–≤–µ—Ä:
```bash
npm run dev
```

5. –û—Ç–∫—Ä–æ–π—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≤ Telegram —á–µ—Ä–µ–∑ —Å—Å—ã–ª–∫—É –æ—Ç –±–æ—Ç–∞ –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ [Telegram Web](https://web.telegram.org)

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
apps/outlivion-miniapp/
‚îú‚îÄ‚îÄ app/                    # Next.js App Router
‚îÇ   ‚îú‚îÄ‚îÄ (auth)/            # –ó–∞—â–∏—â–µ–Ω–Ω—ã–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ page.tsx       # –ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ profile/       # –ü—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ purchase/      # –°—Ç—Ä–∞–Ω–∏—Ü–∞ –ø–æ–∫—É–ø–∫–∏ –ø–æ–¥–ø–∏—Å–∫–∏
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ setup/         # –û–Ω–±–æ—Ä–¥–∏–Ω–≥ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ VPN
‚îÇ   ‚îî‚îÄ‚îÄ api/               # API Routes
‚îÇ       ‚îî‚îÄ‚îÄ tg/            # Telegram API endpoints
‚îú‚îÄ‚îÄ components/            # React –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
‚îÇ   ‚îú‚îÄ‚îÄ blocks/           # –ë–∏–∑–Ω–µ—Å-–∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã (–º–æ–¥–∞–ª–∫–∏)
‚îÇ   ‚îî‚îÄ‚îÄ ui/              # UI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã (BottomSheet)
‚îú‚îÄ‚îÄ lib/                  # –£—Ç–∏–ª–∏—Ç—ã –∏ —Ö–µ–ª–ø–µ—Ä—ã
‚îÇ   ‚îú‚îÄ‚îÄ api.ts           # API –∫–ª–∏–µ–Ω—Ç
‚îÇ   ‚îú‚îÄ‚îÄ auth.ts         # –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ config.ts       # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ telegram.ts     # Telegram WebApp SDK
‚îÇ   ‚îî‚îÄ‚îÄ telegram-validation.ts  # –í–∞–ª–∏–¥–∞—Ü–∏—è initData
‚îú‚îÄ‚îÄ store/               # Zustand stores
‚îÇ   ‚îú‚îÄ‚îÄ subscription.store.ts
‚îÇ   ‚îî‚îÄ‚îÄ user.store.ts
‚îî‚îÄ‚îÄ types/              # TypeScript —Ç–∏–ø—ã
    ‚îú‚îÄ‚îÄ index.ts
    ‚îî‚îÄ‚îÄ telegram.d.ts   # –¢–∏–ø—ã Telegram WebApp API
```

## üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –í–∞–ª–∏–¥–∞—Ü–∏—è Telegram initData

–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç –ø–æ–¥–ø–∏—Å—å `initData` –æ—Ç Telegram –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ –ø–µ—Ä–µ–¥ –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –∑–∞–ø—Ä–æ—Å–æ–≤. –≠—Ç–æ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –ø–æ–¥–¥–µ–ª–∫—É –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

**–í–∞–∂–Ω–æ:** –ù–∏–∫–æ–≥–¥–∞ –Ω–µ –¥–æ–≤–µ—Ä—è–π—Ç–µ –¥–∞–Ω–Ω—ã–º –æ—Ç –∫–ª–∏–µ–Ω—Ç–∞ –±–µ–∑ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–ø–∏—Å–∏ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ!

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

- **–°–µ—Ä–≤–µ—Ä–Ω—ã–µ** (–¥–æ—Å—Ç—É–ø–Ω—ã —Ç–æ–ª—å–∫–æ –≤ API routes):
  - `TELEGRAM_BOT_TOKEN` - —Ç–æ–∫–µ–Ω –±–æ—Ç–∞ (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)

- **–ö–ª–∏–µ–Ω—Ç—Å–∫–∏–µ** (–¥–æ—Å—Ç—É–ø–Ω—ã –≤ –±—Ä–∞—É–∑–µ—Ä–µ, –ø—Ä–µ—Ñ–∏–∫—Å `NEXT_PUBLIC_`):
  - `NEXT_PUBLIC_API_BASE_URL` - –±–∞–∑–æ–≤—ã–π URL API
  - `NEXT_PUBLIC_PAYMENT_REDIRECT_URL` - URL —Ä–µ–¥–∏—Ä–µ–∫—Ç–∞ –ø–ª–∞—Ç–µ–∂–µ–π
  - `NEXT_PUBLIC_SUBSCRIPTION_BASE_URL` - –±–∞–∑–æ–≤—ã–π URL –ø–æ–¥–ø–∏—Å–æ–∫
  - `NEXT_PUBLIC_SUPPORT_TELEGRAM_URL` - —Å—Å—ã–ª–∫–∞ –Ω–∞ –ø–æ–¥–¥–µ—Ä–∂–∫—É
  - `NEXT_PUBLIC_HELP_BASE_URL` - –±–∞–∑–∞ –∑–Ω–∞–Ω–∏–π

## üõ†Ô∏è –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ API endpoint

1. –°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª –≤ `app/api/your-endpoint/route.ts`
2. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `validateTelegramInitData` –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–ø–∏—Å–∏
3. –í–µ—Ä–Ω–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ –≤ —Ñ–æ—Ä–º–∞—Ç–µ JSON

–ü—Ä–∏–º–µ—Ä:
```typescript
import { NextRequest, NextResponse } from 'next/server';
import { validateTelegramInitData } from '@/lib/telegram-validation';
import { serverConfig } from '@/lib/config';

export async function POST(request: NextRequest) {
  const initData = request.headers.get('X-Telegram-Init-Data');
  
  if (!initData || !validateTelegramInitData(initData, serverConfig.telegram.botToken)) {
    return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });
  }
  
  // –í–∞—à–∞ –ª–æ–≥–∏–∫–∞...
}
```

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞

–ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Ä–∞–∑–¥–µ–ª–µ–Ω—ã –Ω–∞:
- **blocks/** - –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ (–º–æ–¥–∞–ª–∫–∏, —Ñ–æ—Ä–º—ã)
- **ui/** - –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ UI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

```bash
# –ó–∞–ø—É—Å–∫ –ª–∏–Ω—Ç–µ—Ä–∞
npm run lint

# TODO: –î–æ–±–∞–≤–∏—Ç—å —Ç–µ—Å—Ç—ã
# npm run test
```

## üì¶ –°–±–æ—Ä–∫–∞ –¥–ª—è production

```bash
npm run build
npm start
```

## üîß Troubleshooting

### –û—à–∏–±–∫–∞ "Missing Telegram initData"
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –æ—Ç–∫—Ä—ã—Ç–æ —á–µ—Ä–µ–∑ Telegram
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ —Å–∫—Ä–∏–ø—Ç `telegram-web-app.js` –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è

### –û—à–∏–±–∫–∞ "Invalid Telegram initData signature"
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ `TELEGRAM_BOT_TOKEN` –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Ç–æ–∫–µ–Ω —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –±–æ—Ç—É, —á–µ—Ä–µ–∑ –∫–æ—Ç–æ—Ä–æ–≥–æ –æ—Ç–∫—Ä—ã—Ç–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ

### API –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ `NEXT_PUBLIC_API_BASE_URL` –≤ `.env.local`
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Å–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω

## üìù TODO

- [ ] –î–æ–±–∞–≤–∏—Ç—å unit-—Ç–µ—Å—Ç—ã
- [ ] –î–æ–±–∞–≤–∏—Ç—å E2E —Ç–µ—Å—Ç—ã
- [ ] –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Ä–µ–∞–ª—å–Ω—ã–º –±—ç–∫–µ–Ω–¥–æ–º API
- [ ] –î–æ–±–∞–≤–∏—Ç—å –∞–Ω–∞–ª–∏—Ç–∏–∫—É —Å–æ–±—ã—Ç–∏–π
- [ ] –£–ª—É—á—à–∏—Ç—å accessibility (ARIA –∞—Ç—Ä–∏–±—É—Ç—ã)
- [ ] –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å (lazy loading, memo)

## üìÑ –õ–∏—Ü–µ–Ω–∑–∏—è

Private
