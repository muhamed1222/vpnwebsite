# üîç –ê–Ω–∞–ª–∏–∑ —Å–∏—Å—Ç–µ–º—ã –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è –±–∏–ª–µ—Ç–æ–≤

**–î–∞—Ç–∞ –∞–Ω–∞–ª–∏–∑–∞:** 2026-01-17  
**–°—Ç–∞—Ç—É—Å:** –í –ø—Ä–æ—Ü–µ—Å—Å–µ –∞–Ω–∞–ª–∏–∑–∞

---

## üìã –¢–µ–∫—É—â–∞—è —Å–∏—Ç—É–∞—Ü–∏—è

### –¢–∏–ø—ã –±–∏–ª–µ—Ç–æ–≤ –≤ —Å–∏—Å—Ç–µ–º–µ:
- **SELF_PURCHASE** - –±–∏–ª–µ—Ç –∑–∞ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—É—é –ø–æ–∫—É–ø–∫—É
- **INVITEE_PAYMENT** - –±–∏–ª–µ—Ç –∑–∞ –ø–æ–∫—É–ø–∫—É –ø—Ä–∏–≥–ª–∞—à–µ–Ω–Ω–æ–≥–æ –¥—Ä—É–≥–∞
- **REFUND** - –≤–æ–∑–≤—Ä–∞—Ç –±–∏–ª–µ—Ç–∞ (–æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–π delta)

### –¢–µ–∫—É—â–∏–µ –¥–∞–Ω–Ω—ã–µ:
- –í—Å–µ–≥–æ –±–∏–ª–µ—Ç–æ–≤ –≤ –∫–æ–Ω–∫—É—Ä—Å–µ: `1` (—Ç–æ–ª—å–∫–æ SELF_PURCHASE)
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å 782245481: `1` –±–∏–ª–µ—Ç (–ø–æ—Å–ª–µ —É–¥–∞–ª–µ–Ω–∏—è —Å—Ç–∞—Ä—ã—Ö)

---

## üîç –ù–∞–π–¥–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### ‚ùå –ü–†–û–ë–õ–ï–ú–ê 1: –ù–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥–∞—Ç—ã –Ω–∞—á–∞–ª–∞ –∫–æ–Ω–∫—É—Ä—Å–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –±–∏–ª–µ—Ç–æ–≤

**–¢–µ–∫—É—â–∞—è –ª–æ–≥–∏–∫–∞:**
- –ë–∏–ª–µ—Ç—ã —Å–æ–∑–¥–∞—é—Ç—Å—è –≤ –±–æ—Ç–µ (`/root/vpn_bot/src/services/contestService.ts`)
- –ù—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å, —É—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –ª–∏ `contest.starts_at` –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –±–∏–ª–µ—Ç–æ–≤

**–†–∏—Å–∫:**
- –ë–∏–ª–µ—Ç—ã –º–æ–≥—É—Ç –Ω–∞—á–∏—Å–ª—è—Ç—å—Å—è –∑–∞ –ø–æ–∫—É–ø–∫–∏, —Å–¥–µ–ª–∞–Ω–Ω—ã–µ –î–û –∑–∞–ø—É—Å–∫–∞ –∫–æ–Ω–∫—É—Ä—Å–∞
- –≠—Ç–æ –Ω–µ—Å–ø—Ä–∞–≤–µ–¥–ª–∏–≤–æ –ø–æ –æ—Ç–Ω–æ—à–µ–Ω–∏—é –∫ –¥—Ä—É–≥–∏–º —É—á–∞—Å—Ç–Ω–∏–∫–∞–º

**–†–µ—à–µ–Ω–∏–µ:**
- –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É: `order.created_at >= contest.starts_at`
- –°–æ–∑–¥–∞–≤–∞—Ç—å –±–∏–ª–µ—Ç—ã —Ç–æ–ª—å–∫–æ –¥–ª—è –ø–æ–∫—É–ø–æ–∫ –ø–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ –∫–æ–Ω–∫—É—Ä—Å–∞

---

### ‚ùå –ü–†–û–ë–õ–ï–ú–ê 2: –ù–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥–∞—Ç—ã –æ–∫–æ–Ω—á–∞–Ω–∏—è –∫–æ–Ω–∫—É—Ä—Å–∞

**–†–∏—Å–∫:**
- –ë–∏–ª–µ—Ç—ã –º–æ–≥—É—Ç –Ω–∞—á–∏—Å–ª—è—Ç—å—Å—è –∑–∞ –ø–æ–∫—É–ø–∫–∏, —Å–¥–µ–ª–∞–Ω–Ω—ã–µ –ü–û–°–õ–ï –æ–∫–æ–Ω—á–∞–Ω–∏—è –∫–æ–Ω–∫—É—Ä—Å–∞
- –≠—Ç–æ –º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–µ–∂–µ–ª–∞—Ç–µ–ª—å–Ω—ã–º –ø–æ–≤–µ–¥–µ–Ω–∏–µ–º

**–†–µ—à–µ–Ω–∏–µ:**
- –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É: `order.created_at <= contest.ends_at`
- –°–æ–∑–¥–∞–≤–∞—Ç—å –±–∏–ª–µ—Ç—ã —Ç–æ–ª—å–∫–æ –¥–ª—è –ø–æ–∫—É–ø–æ–∫ –≤–æ –≤—Ä–µ–º—è –∫–æ–Ω–∫—É—Ä—Å–∞

---

### ‚ùå –ü–†–û–ë–õ–ï–ú–ê 3: –ù–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –æ–∫–Ω–∞ –∞—Ç—Ä–∏–±—É—Ü–∏–∏ (attribution_window_days)

**–¢–µ–∫—É—â–∞—è –ª–æ–≥–∏–∫–∞:**
- `attribution_window_days = 7` –¥–Ω–µ–π
- –≠—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ –ø–æ–∫—É–ø–∫–∏ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–Ω—ã—Ö –¥—Ä—É–∑–µ–π –∑–∞—Å—á–∏—Ç—ã–≤–∞—é—Ç—Å—è –≤ —Ç–µ—á–µ–Ω–∏–µ 7 –¥–Ω–µ–π –ø–æ—Å–ª–µ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è

**–†–∏—Å–∫:**
- –ù—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å, —É—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –ª–∏ —ç—Ç–æ –æ–∫–Ω–æ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –±–∏–ª–µ—Ç–æ–≤ –∑–∞ –ø–æ–∫—É–ø–∫–∏ –¥—Ä—É–∑–µ–π

**–†–µ—à–µ–Ω–∏–µ:**
- –î–ª—è INVITEE_PAYMENT: –ø—Ä–æ–≤–µ—Ä—è—Ç—å `order.created_at <= ref_event.bound_at + attribution_window_days`
- –°–æ–∑–¥–∞–≤–∞—Ç—å –±–∏–ª–µ—Ç—ã —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –ø–æ–∫—É–ø–∫–∞ –≤ –ø—Ä–µ–¥–µ–ª–∞—Ö –æ–∫–Ω–∞ –∞—Ç—Ä–∏–±—É—Ü–∏–∏

---

### ‚ö†Ô∏è –ü–†–û–ë–õ–ï–ú–ê 4: –ú–∞—Å—Å–æ–≤–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ –±–∏–ª–µ—Ç–æ–≤ –ø—Ä–∏ –∫–≤–∞–ª–∏—Ñ–∏–∫–∞—Ü–∏–∏

**–¢–µ–∫—É—â–∞—è —Å–∏—Ç—É–∞—Ü–∏—è:**
- –ë–∏–ª–µ—Ç—ã —Å–æ–∑–¥–∞—é—Ç—Å—è –º–∞—Å—Å–æ–≤–æ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –æ–±—Ä–∞—â–µ–Ω–∏–∏ –∫ API –∫–æ–Ω–∫—É—Ä—Å–∞
- –í—Å–µ —Å—Ç–∞—Ä—ã–µ –∑–∞–∫–∞–∑—ã –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ

**–†–∏—Å–∫:**
- –ë–∏–ª–µ—Ç—ã –∑–∞ —Å—Ç–∞—Ä—ã–µ –ø–æ–∫—É–ø–∫–∏ –º–æ–≥—É—Ç –Ω–∞—á–∏—Å–ª—è—Ç—å—Å—è –¥–∞–∂–µ –µ—Å–ª–∏ –æ–Ω–∏ –±—ã–ª–∏ –¥–æ –∑–∞–ø—É—Å–∫–∞ –∫–æ–Ω–∫—É—Ä—Å–∞
- –≠—Ç–æ —É–∂–µ –ø—Ä–æ–∏–∑–æ—à–ª–æ —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º 782245481

**–†–µ—à–µ–Ω–∏–µ:**
- –ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –±–∏–ª–µ—Ç–æ–≤ –ø—Ä–æ–≤–µ—Ä—è—Ç—å –¥–∞—Ç—É –Ω–∞—á–∞–ª–∞ –∫–æ–Ω–∫—É—Ä—Å–∞
- –ù–µ —Å–æ–∑–¥–∞–≤–∞—Ç—å –±–∏–ª–µ—Ç—ã –∑–∞ –ø–æ–∫—É–ø–∫–∏ –¥–æ –∑–∞–ø—É—Å–∫–∞ –∫–æ–Ω–∫—É—Ä—Å–∞

---

## ‚úÖ –ß—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ

1. ‚úÖ **–¢–∏–ø—ã –±–∏–ª–µ—Ç–æ–≤:** SELF_PURCHASE –∏ INVITEE_PAYMENT –ø—Ä–∞–≤–∏–ª—å–Ω–æ —Ä–∞–∑–¥–µ–ª–µ–Ω—ã
2. ‚úÖ **Delta —Å–∏—Å—Ç–µ–º–∞:** –ü–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–µ –∏ –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
3. ‚úÖ **–ß—Ç–µ–Ω–∏–µ –±–∏–ª–µ—Ç–æ–≤:** API –ø—Ä–∞–≤–∏–ª—å–Ω–æ —á–∏—Ç–∞–µ—Ç –±–∏–ª–µ—Ç—ã –∏–∑ ticket_ledger
4. ‚úÖ **–ü–æ–¥—Å—á–µ—Ç –±–∏–ª–µ—Ç–æ–≤:** –°—É–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ delta —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

---

## üîß –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—é

### 1. –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –¥–∞—Ç—ã –Ω–∞—á–∞–ª–∞ –∫–æ–Ω–∫—É—Ä—Å–∞

–í —Ñ–∞–π–ª–µ `/root/vpn_bot/src/services/contestService.ts`:

```typescript
// –ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –±–∏–ª–µ—Ç–∞ –∑–∞ –ø–æ–∫—É–ø–∫—É (SELF_PURCHASE)
if (order.created_at < contest.starts_at) {
  // –ù–µ —Å–æ–∑–¥–∞–≤–∞—Ç—å –±–∏–ª–µ—Ç - –ø–æ–∫—É–ø–∫–∞ –±—ã–ª–∞ –¥–æ –∑–∞–ø—É—Å–∫–∞ –∫–æ–Ω–∫—É—Ä—Å–∞
  return;
}

// –ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –±–∏–ª–µ—Ç–∞ –∑–∞ –ø–æ–∫—É–ø–∫—É –¥—Ä—É–≥–∞ (INVITEE_PAYMENT)
if (order.created_at < contest.starts_at) {
  // –ù–µ —Å–æ–∑–¥–∞–≤–∞—Ç—å –±–∏–ª–µ—Ç - –ø–æ–∫—É–ø–∫–∞ –±—ã–ª–∞ –¥–æ –∑–∞–ø—É—Å–∫–∞ –∫–æ–Ω–∫—É—Ä—Å–∞
  return;
}
```

### 2. –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –¥–∞—Ç—ã –æ–∫–æ–Ω—á–∞–Ω–∏—è –∫–æ–Ω–∫—É—Ä—Å–∞

```typescript
if (order.created_at > contest.ends_at) {
  // –ù–µ —Å–æ–∑–¥–∞–≤–∞—Ç—å –±–∏–ª–µ—Ç - –ø–æ–∫—É–ø–∫–∞ –±—ã–ª–∞ –ø–æ—Å–ª–µ –æ–∫–æ–Ω—á–∞–Ω–∏—è –∫–æ–Ω–∫—É—Ä—Å–∞
  return;
}
```

### 3. –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –æ–∫–Ω–∞ –∞—Ç—Ä–∏–±—É—Ü–∏–∏

```typescript
// –î–ª—è INVITEE_PAYMENT
const attributionDeadline = new Date(refEvent.bound_at);
attributionDeadline.setDate(attributionDeadline.getDate() + contest.attribution_window_days);

if (order.created_at > attributionDeadline) {
  // –ù–µ —Å–æ–∑–¥–∞–≤–∞—Ç—å –±–∏–ª–µ—Ç - –ø–æ–∫—É–ø–∫–∞ –≤–Ω–µ –æ–∫–Ω–∞ –∞—Ç—Ä–∏–±—É—Ü–∏–∏
  return;
}
```

---

## üìù –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–¥ –±–æ—Ç–∞:**
   - –û—Ç–∫—Ä—ã—Ç—å `/root/vpn_bot/src/services/contestService.ts`
   - –ù–∞–π—Ç–∏ —Ñ—É–Ω–∫—Ü–∏—é —Å–æ–∑–¥–∞–Ω–∏—è –±–∏–ª–µ—Ç–æ–≤
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, –µ—Å—Ç—å –ª–∏ –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥–∞—Ç

2. **–ò—Å–ø—Ä–∞–≤–∏—Ç—å –ª–æ–≥–∏–∫—É:**
   - –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É `order.created_at >= contest.starts_at`
   - –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É `order.created_at <= contest.ends_at`
   - –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –æ–∫–Ω–∞ –∞—Ç—Ä–∏–±—É—Ü–∏–∏ –¥–ª—è INVITEE_PAYMENT

3. **–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å:**
   - –°–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–π –∑–∞–∫–∞–∑ –¥–æ –∑–∞–ø—É—Å–∫–∞ –∫–æ–Ω–∫—É—Ä—Å–∞ - –±–∏–ª–µ—Ç –Ω–µ –¥–æ–ª–∂–µ–Ω —Å–æ–∑–¥–∞—Ç—å—Å—è
   - –°–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–π –∑–∞–∫–∞–∑ –ø–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ - –±–∏–ª–µ—Ç –¥–æ–ª–∂–µ–Ω —Å–æ–∑–¥–∞—Ç—å—Å—è
   - –°–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–π –∑–∞–∫–∞–∑ –ø–æ—Å–ª–µ –æ–∫–æ–Ω—á–∞–Ω–∏—è - –±–∏–ª–µ—Ç –Ω–µ –¥–æ–ª–∂–µ–Ω —Å–æ–∑–¥–∞—Ç—å—Å—è

---

**–°—Ç–∞—Ç—É—Å:** –¢—Ä–µ–±—É–µ—Ç—Å—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–¥–∞ –±–æ—Ç–∞ –∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ª–æ–≥–∏–∫–∏ —Å–æ–∑–¥–∞–Ω–∏—è –±–∏–ª–µ—Ç–æ–≤
