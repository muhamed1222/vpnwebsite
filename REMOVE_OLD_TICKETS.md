# üóëÔ∏è –£–¥–∞–ª–µ–Ω–∏–µ –±–∏–ª–µ—Ç–æ–≤ –∑–∞ –ø–æ–∫—É–ø–∫–∏ –¥–æ –∑–∞–ø—É—Å–∫–∞ –∫–æ–Ω–∫—É—Ä—Å–∞

**–ü—Ä–æ–±–ª–µ–º–∞:** –£ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è 782245481 –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è 4 –±–∏–ª–µ—Ç–∞, —Ö–æ—Ç—è –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ –ø–æ–∫—É–ø–∫–∏ –±—ã–ª–∏ —Å–¥–µ–ª–∞–Ω—ã –¥–æ –∑–∞–ø—É—Å–∫–∞ –∫–æ–Ω–∫—É—Ä—Å–∞.

**–†–µ—à–µ–Ω–∏–µ:** –£–¥–∞–ª–∏—Ç—å –±–∏–ª–µ—Ç—ã –∑–∞ –ø–æ–∫—É–ø–∫–∏, —Å–¥–µ–ª–∞–Ω–Ω—ã–µ –¥–æ –∑–∞–ø—É—Å–∫–∞ –∫–æ–Ω–∫—É—Ä—Å–∞ (2026-01-17 00:00:00 UTC).

---

## üìã –ê–Ω–∞–ª–∏–∑

### –ó–∞–ø—É—Å–∫ –∫–æ–Ω–∫—É—Ä—Å–∞:
- **–î–∞—Ç–∞:** `2026-01-17 00:00:00 UTC`
- **Timestamp:** `1768675200000` (–º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥—ã)

### –ó–∞–∫–∞–∑—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è 782245481:
1. `ord_08f082c1...` - `2026-01-08 20:25:24` - **–î–û –∑–∞–ø—É—Å–∫–∞** ‚ùå
2. `ord_3486b3e9...` - `2026-01-09 11:52:23` - **–î–û –∑–∞–ø—É—Å–∫–∞** ‚ùå
3. `ord_be1b7f4e...` - `2026-01-09 17:10:35` - **–î–û –∑–∞–ø—É—Å–∫–∞** ‚ùå
4. `ord_f400a8b9...` - `2026-01-17 15:14:04` - **–ü–û–°–õ–ï –∑–∞–ø—É—Å–∫–∞** ‚úÖ

### –ë–∏–ª–µ—Ç—ã –≤ ticket_ledger:
–í—Å–µ 4 –±–∏–ª–µ—Ç–∞ —Å–æ–∑–¥–∞–Ω—ã –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ –≤ `2026-01-17 15:24:01`

---

## ‚úÖ –†–µ—à–µ–Ω–∏–µ: –£–¥–∞–ª–∏—Ç—å –±–∏–ª–µ—Ç—ã –∑–∞ –ø–æ–∫—É–ø–∫–∏ –¥–æ –∑–∞–ø—É—Å–∫–∞

### –®–∞–≥ 1: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç–µ–∫—É—â–∏–µ –±–∏–ª–µ—Ç—ã
```bash
ssh root@72.56.93.135
sqlite3 /root/vpn_bot/data/database.sqlite "
SELECT 
  tl.id, 
  tl.order_id, 
  o.created_at as order_created,
  datetime(o.created_at/1000, 'unixepoch') as order_date,
  CASE WHEN o.created_at >= 1768675200000 THEN 'AFTER' ELSE 'BEFORE' END as period
FROM ticket_ledger tl
LEFT JOIN orders o ON o.id = tl.order_id
WHERE tl.contest_id = '550e8400-e29b-41d4-a716-446655440000' 
  AND tl.referrer_id = 782245481
ORDER BY o.created_at;
"
```

### –®–∞–≥ 2: –£–¥–∞–ª–∏—Ç—å –±–∏–ª–µ—Ç—ã –∑–∞ –ø–æ–∫—É–ø–∫–∏ –¥–æ –∑–∞–ø—É—Å–∫–∞ –∫–æ–Ω–∫—É—Ä—Å–∞
```bash
sqlite3 /root/vpn_bot/data/database.sqlite "
DELETE FROM ticket_ledger
WHERE contest_id = '550e8400-e29b-41d4-a716-446655440000'
  AND referrer_id = 782245481
  AND order_id IN (
    SELECT id FROM orders 
    WHERE user_id = 782245481 
      AND status = 'COMPLETED'
      AND created_at < 1768675200000  -- –î–æ –∑–∞–ø—É—Å–∫–∞ –∫–æ–Ω–∫—É—Ä—Å–∞
  );
"
```

### –®–∞–≥ 3: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç
```bash
sqlite3 /root/vpn_bot/data/database.sqlite "
SELECT 
  COUNT(*) as remaining_tickets,
  GROUP_CONCAT(order_id) as order_ids
FROM ticket_ledger
WHERE contest_id = '550e8400-e29b-41d4-a716-446655440000'
  AND referrer_id = 782245481;
"
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:** –î–æ–ª–∂–Ω–æ –æ—Å—Ç–∞—Ç—å—Å—è —Ç–æ–ª—å–∫–æ 1 –±–∏–ª–µ—Ç (–∑–∞ –∑–∞–∫–∞–∑ `ord_f400a8b9...`)

---

## üîß –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞: –£–¥–∞–ª–∏—Ç—å –≤—Å–µ –±–∏–ª–µ—Ç—ã –∏ –ø–µ—Ä–µ—Å–æ–∑–¥–∞—Ç—å —Ç–æ–ª—å–∫–æ –∑–∞ –ø–æ–∫—É–ø–∫–∏ –ø–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞

–ï—Å–ª–∏ –Ω—É–∂–Ω–æ –ø–µ—Ä–µ—Å–æ–∑–¥–∞—Ç—å –±–∏–ª–µ—Ç—ã —Ç–æ–ª—å–∫–æ –∑–∞ –ø–æ–∫—É–ø–∫–∏ –ø–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞:

```bash
# 1. –£–¥–∞–ª–∏—Ç—å –≤—Å–µ –±–∏–ª–µ—Ç—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
sqlite3 /root/vpn_bot/data/database.sqlite "
DELETE FROM ticket_ledger
WHERE contest_id = '550e8400-e29b-41d4-a716-446655440000'
  AND referrer_id = 782245481;
"

# 2. –°–æ–∑–¥–∞—Ç—å –±–∏–ª–µ—Ç—ã —Ç–æ–ª—å–∫–æ –∑–∞ –ø–æ–∫—É–ø–∫–∏ –ø–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞
sqlite3 /root/vpn_bot/data/database.sqlite "
INSERT INTO ticket_ledger (id, contest_id, referrer_id, referred_id, order_id, delta, reason, created_at)
SELECT 
  lower(hex(randomblob(16))) as id,
  '550e8400-e29b-41d4-a716-446655440000' as contest_id,
  o.user_id as referrer_id,
  o.user_id as referred_id,
  o.id as order_id,
  1 as delta,
  'SELF_PURCHASE' as reason,
  datetime('now') as created_at
FROM orders o
WHERE o.user_id = 782245481
  AND o.status = 'COMPLETED'
  AND o.created_at >= 1768675200000;  -- –¢–æ–ª—å–∫–æ –ø–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ –∫–æ–Ω–∫—É—Ä—Å–∞
"
```

---

## ‚ö†Ô∏è –í–∞–∂–Ω–æ

–ü–æ—Å–ª–µ —É–¥–∞–ª–µ–Ω–∏—è –±–∏–ª–µ—Ç–æ–≤:
- ‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–≤–∏–¥–∏—Ç —Ç–æ–ª—å–∫–æ –±–∏–ª–µ—Ç—ã –∑–∞ –ø–æ–∫—É–ø–∫–∏ –ø–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ –∫–æ–Ω–∫—É—Ä—Å–∞
- ‚úÖ –≠—Ç–æ —Å–ø—Ä–∞–≤–µ–¥–ª–∏–≤–æ - –±–∏–ª–µ—Ç—ã –Ω–∞—á–∏—Å–ª—è—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –∑–∞ –ø–æ–∫—É–ø–∫–∏ –≤–æ –≤—Ä–µ–º—è –∫–æ–Ω–∫—É—Ä—Å–∞
- ‚úÖ –°—Ç–∞—Ä—ã–µ –ø–æ–∫—É–ø–∫–∏ –Ω–µ —É—á–∏—Ç—ã–≤–∞—é—Ç—Å—è

---

## üìù –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Å–ª–µ —É–¥–∞–ª–µ–Ω–∏—è

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–∏–ª–µ—Ç–æ–≤
sqlite3 /root/vpn_bot/data/database.sqlite "
SELECT 
  referrer_id,
  COUNT(*) as tickets_count,
  SUM(delta) as total_tickets
FROM ticket_ledger
WHERE contest_id = '550e8400-e29b-41d4-a716-446655440000'
  AND referrer_id = 782245481
GROUP BY referrer_id;
"
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:** `tickets_count = 1`, `total_tickets = 1`

---

**–ì–æ—Ç–æ–≤–æ!** –ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —ç—Ç–∏—Ö –∫–æ–º–∞–Ω–¥ —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –±—É–¥–µ—Ç —Ç–æ–ª—å–∫–æ 1 –±–∏–ª–µ—Ç (–∑–∞ –ø–æ–∫—É–ø–∫—É –ø–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ –∫–æ–Ω–∫—É—Ä—Å–∞).
