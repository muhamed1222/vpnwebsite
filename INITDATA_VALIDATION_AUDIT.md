# –ê—É–¥–∏—Ç –≤–∞–ª–∏–¥–∞—Ü–∏–∏ Telegram initData –≤ API routes

## –î–∞—Ç–∞ –∞—É–¥–∏—Ç–∞
2025-01-27

## –ü—Ä–æ–±–ª–µ–º–∞
–í–∞–ª–∏–¥–∞—Ü–∏—è Telegram initData –µ—Å—Ç—å –Ω–µ –≤–æ –≤—Å–µ—Ö API routes, —á—Ç–æ –º–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –ø–æ–¥–º–µ–Ω–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

## –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –∞—É–¥–∏—Ç–∞

### ‚úÖ Routes —Å –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π initData

1. **`/api/me`** ‚úÖ
   - –í–∞–ª–∏–¥–∞—Ü–∏—è: –î–∞
   - –£—Å–ª–æ–≤–∏–µ: –ï—Å–ª–∏ —Ç–æ–∫–µ–Ω —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –∏–ª–∏ –Ω–µ dev —Ä–µ–∂–∏–º

2. **`/api/tg/auth`** ‚úÖ
   - –í–∞–ª–∏–¥–∞—Ü–∏—è: –î–∞
   - –£—Å–ª–æ–≤–∏–µ: –ï—Å–ª–∏ —Ç–æ–∫–µ–Ω —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω

3. **`/api/tariffs`** ‚úÖ
   - –í–∞–ª–∏–¥–∞—Ü–∏—è: –î–∞
   - –£—Å–ª–æ–≤–∏–µ: –ï—Å–ª–∏ —Ç–æ–∫–µ–Ω —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω

4. **`/api/payments/history`** ‚úÖ
   - –í–∞–ª–∏–¥–∞—Ü–∏—è: –î–∞
   - –£—Å–ª–æ–≤–∏–µ: –ï—Å–ª–∏ —Ç–æ–∫–µ–Ω —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω

5. **`/api/contest/active`** ‚úÖ
   - –í–∞–ª–∏–¥–∞—Ü–∏—è: –î–∞
   - –£—Å–ª–æ–≤–∏–µ: –ï—Å–ª–∏ –Ω–µ—Ç –∞–¥–º–∏–Ω—Å–∫–æ–π —Å–µ—Å—Å–∏–∏ –∏ —Ç–æ–∫–µ–Ω —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω

6. **`/api/admin/contest/participants`** ‚úÖ
   - –í–∞–ª–∏–¥–∞—Ü–∏—è: –î–∞
   - –£—Å–ª–æ–≤–∏–µ: –ï—Å–ª–∏ –Ω–µ—Ç –∞–¥–º–∏–Ω—Å–∫–æ–π —Å–µ—Å—Å–∏–∏ –∏ —Ç–æ–∫–µ–Ω —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω

7. **`/api/referral/friends`** ‚úÖ
   - –í–∞–ª–∏–¥–∞—Ü–∏—è: –î–∞
   - –£—Å–ª–æ–≤–∏–µ: –ï—Å–ª–∏ —Ç–æ–∫–µ–Ω —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω

8. **`/api/referral/tickets`** ‚úÖ
   - –í–∞–ª–∏–¥–∞—Ü–∏—è: –î–∞
   - –£—Å–ª–æ–≤–∏–µ: –ï—Å–ª–∏ —Ç–æ–∫–µ–Ω —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω

9. **`/api/referral/summary`** ‚úÖ
   - –í–∞–ª–∏–¥–∞—Ü–∏—è: –î–∞
   - –£—Å–ª–æ–≤–∏–µ: –ï—Å–ª–∏ —Ç–æ–∫–µ–Ω —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω

10. **`/api/user/referrals/history`** ‚úÖ
    - –í–∞–ª–∏–¥–∞—Ü–∏—è: –î–∞
    - –£—Å–ª–æ–≤–∏–µ: –ï—Å–ª–∏ —Ç–æ–∫–µ–Ω —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω

11. **`/api/user/autorenewal`** ‚úÖ
    - –í–∞–ª–∏–¥–∞—Ü–∏—è: –î–∞ (GET –∏ POST)
    - –£—Å–ª–æ–≤–∏–µ: –ï—Å–ª–∏ —Ç–æ–∫–µ–Ω —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω

12. **`/api/user/billing`** ‚úÖ
    - –í–∞–ª–∏–¥–∞—Ü–∏—è: –î–∞
    - –£—Å–ª–æ–≤–∏–µ: –ï—Å–ª–∏ —Ç–æ–∫–µ–Ω —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω

13. **`/api/orders/create`** ‚úÖ
    - –í–∞–ª–∏–¥–∞—Ü–∏—è: –î–∞
    - –£—Å–ª–æ–≤–∏–µ: –ï—Å–ª–∏ —Ç–æ–∫–µ–Ω —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω

14. **`/api/user/config`** ‚úÖ
    - –í–∞–ª–∏–¥–∞—Ü–∏—è: –î–∞
    - –£—Å–ª–æ–≤–∏–µ: –ï—Å–ª–∏ —Ç–æ–∫–µ–Ω —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω

15. **`/api/user/referrals`** ‚úÖ
    - –í–∞–ª–∏–¥–∞—Ü–∏—è: –î–∞
    - –£—Å–ª–æ–≤–∏–µ: –ï—Å–ª–∏ —Ç–æ–∫–µ–Ω —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω

16. **`/api/user/status`** ‚úÖ
    - –í–∞–ª–∏–¥–∞—Ü–∏—è: –î–∞
    - –£—Å–ª–æ–≤–∏–µ: –ï—Å–ª–∏ —Ç–æ–∫–µ–Ω —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω

### ‚ö†Ô∏è Routes –±–µ–∑ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ initData (–Ω–æ —ç—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ)

1. **`/api/admin/auth`** ‚ö†Ô∏è
   - –í–∞–ª–∏–¥–∞—Ü–∏—è: –ù–µ—Ç
   - –ü—Ä–∏—á–∏–Ω–∞: –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –ø–∞—Ä–æ–ª—å –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏, –Ω–µ —Ç—Ä–µ–±—É–µ—Ç initData
   - –°—Ç–∞—Ç—É—Å: ‚úÖ –ù–æ—Ä–º–∞–ª—å–Ω–æ (—ç—Ç–æ –∞–¥–º–∏–Ω—Å–∫–∏–π —Ä–æ—É—Ç –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏)

2. **`/api/sentry-example-api`** ‚ö†Ô∏è
   - –í–∞–ª–∏–¥–∞—Ü–∏—è: –ù–µ—Ç
   - –ü—Ä–∏—á–∏–Ω–∞: –¢–µ—Å—Ç–æ–≤—ã–π —Ä–æ—É—Ç –¥–ª—è Sentry, –Ω–µ —Ç—Ä–µ–±—É–µ—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
   - –°—Ç–∞—Ç—É—Å: ‚úÖ –ù–æ—Ä–º–∞–ª—å–Ω–æ (—Ç–µ—Å—Ç–æ–≤—ã–π —Ä–æ—É—Ç)

## –ü—Ä–æ–±–ª–µ–º—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

### üî¥ –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–±–ª–µ–º–∞

**–£—Å–ª–æ–≤–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è:** –í–æ –≤—Å–µ—Ö routes –≤–∞–ª–∏–¥–∞—Ü–∏—è –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ `serverConfig.telegram.botToken` —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω:

```typescript
if (serverConfig.telegram.botToken) {
  const isValid = validateTelegramInitData(initData, botToken);
  // ...
}
```

**–†–∏—Å–∫:** –ï—Å–ª–∏ —Ç–æ–∫–µ–Ω –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –≤ production, –≤–∞–ª–∏–¥–∞—Ü–∏—è –Ω–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è, —á—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –ø–æ–¥–º–µ–Ω—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

### üü° –°—Ä–µ–¥–Ω—è—è –ø—Ä–æ–±–ª–µ–º–∞

**–ù–µ—Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç—å:** –†–∞–∑–Ω—ã–µ routes –∏—Å–ø–æ–ª—å–∑—É—é—Ç —Ä–∞–∑–Ω—ã–µ –ø–æ–¥—Ö–æ–¥—ã –∫ –≤–∞–ª–∏–¥–∞—Ü–∏–∏:
- –ù–µ–∫–æ—Ç–æ—Ä—ã–µ –ø—Ä–æ–≤–µ—Ä—è—é—Ç –Ω–∞–ª–∏—á–∏–µ initData –ø–µ—Ä–µ–¥ –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π
- –ù–µ–∫–æ—Ç–æ—Ä—ã–µ –ø—Ä–æ–ø—É—Å–∫–∞—é—Ç –≤–∞–ª–∏–¥–∞—Ü–∏—é –≤ dev —Ä–µ–∂–∏–º–µ
- –ù–µ–∫–æ—Ç–æ—Ä—ã–µ –∏–º–µ—é—Ç fallback –Ω–∞ –∞–¥–º–∏–Ω—Å–∫—É—é —Å–µ—Å—Å–∏—é

## –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

### 1. –û–±—è–∑–∞—Ç–µ–ª—å–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è –≤ production

–í–∞–ª–∏–¥–∞—Ü–∏—è –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–π –≤ production, –¥–∞–∂–µ –µ—Å–ª–∏ —Ç–æ–∫–µ–Ω –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω (–≤ —ç—Ç–æ–º —Å–ª—É—á–∞–µ –Ω—É–∂–Ω–æ –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å –æ—à–∏–±–∫—É –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏).

### 2. –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è —É—Ç–∏–ª–∏—Ç–∞

–°–æ–∑–¥–∞—Ç—å —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—É—é —É—Ç–∏–ª–∏—Ç—É `lib/utils/api-validation.ts` –¥–ª—è –µ–¥–∏–Ω–æ–æ–±—Ä–∞–∑–Ω–æ–π –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –≤–æ –≤—Å–µ—Ö routes.

### 3. –£–ª—É—á—à–µ–Ω–∏–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫

–ï—Å–ª–∏ —Ç–æ–∫–µ–Ω –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –≤ production, –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å –æ—à–∏–±–∫—É 500 (Internal Server Error), –∞ –Ω–µ –ø—Ä–æ–ø—É—Å–∫–∞—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é.

### 4. –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

–õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ –ø–æ–ø—ã—Ç–∫–∏ –¥–æ—Å—Ç—É–ø–∞ —Å –Ω–µ–≤–∞–ª–∏–¥–Ω—ã–º initData –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –∞—Ç–∞–∫.

## –ü–ª–∞–Ω –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

1. ‚úÖ –°–æ–∑–¥–∞—Ç—å —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—É—é —É—Ç–∏–ª–∏—Ç—É `lib/utils/api-validation.ts`
2. ‚è≥ –û–±–Ω–æ–≤–∏—Ç—å –≤—Å–µ routes –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–π –≤–∞–ª–∏–¥–∞—Ü–∏–∏
3. ‚è≥ –î–æ–±–∞–≤–∏—Ç—å –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—É—é –≤–∞–ª–∏–¥–∞—Ü–∏—é –≤ production
4. ‚è≥ –î–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–µ–≤–∞–ª–∏–¥–Ω—ã—Ö –ø–æ–ø—ã—Ç–æ–∫ –¥–æ—Å—Ç—É–ø–∞
5. ‚è≥ –ü—Ä–æ–≤–µ—Å—Ç–∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

## –°—Ç–∞—Ç—É—Å

- **Routes —Å –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π:** 16/18 (89%)
- **Routes –±–µ–∑ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ (–Ω–æ—Ä–º–∞–ª—å–Ω–æ):** 2/18 (11%)
- **–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã:** 1
- **–°—Ä–µ–¥–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã:** 1
